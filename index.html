<!DOCTYPE html>
<html lang="id">
<head>
    <!-- Existing head content remains unchanged -->
</head>
<body>
    <!-- Existing header, nav, hero, news, and footer sections remain unchanged -->

    <!-- Existing Modals (Login, Register, Privacy, Terms, FAQ, Sitemap) -->
    <!-- ... (keep all existing modals as they are) ... -->

    <!-- New Modal for Peta Pertanahan -->
    <div class="modal fade quick-link-modal" id="mapModal" tabindex="-1" aria-labelledby="mapModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="mapModalLabel">Peta Pertanahan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <iframe src="https://landadministration.github.io/Landas/" style="width: 100%; height: 500px; border: none;" title="Peta Pertanahan"></iframe>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Inisialisasi localStorage untuk users jika belum ada
        if (!localStorage.getItem('users')) {
            localStorage.setItem('users', JSON.stringify([]));
        }

        // Ambil currentUser dari localStorage atau sessionStorage
        let currentUser = JSON.parse(localStorage.getItem('currentUser') || sessionStorage.getItem('currentUser')) || null;

        // Fungsi untuk memeriksa status login dan memperbarui UI
        function checkLoginStatus() {
            const loginBtn = document.querySelector('.login-btn');
            const logoutBtn = document.querySelector('.logout-btn');
            
            if (loginBtn && logoutBtn) {
                if (currentUser) {
                    loginBtn.classList.add('d-none');
                    logoutBtn.classList.remove('d-none');
                } else {
                    loginBtn.classList.remove('d-none');
                    logoutBtn.classList.add('d-none');
                }
            }
        }

        // Fungsi untuk mengalihkan visibilitas password
        function togglePasswordVisibility(inputId, toggleId) {
            const passwordInput = document.getElementById(inputId);
            const toggleIcon = document.getElementById(toggleId);
            if (passwordInput && toggleIcon) {
                toggleIcon.addEventListener('click', function() {
                    const isPassword = passwordInput.type === 'password';
                    passwordInput.type = isPassword ? 'text' : 'password';
                    toggleIcon.classList.toggle('fa-eye', isPassword);
                    toggleIcon.classList.toggle('fa-eye-slash', !isPassword);
                });
            }
        }

        // Inisialisasi toggle password
        togglePasswordVisibility('loginPassword', 'toggleLoginPassword');
        togglePasswordVisibility('registerPassword', 'toggleRegisterPassword');
        togglePasswordVisibility('registerConfirmPassword', 'toggleConfirmPassword');

        // Penanganan form login
        const loginForm = document.getElementById('loginForm');
        if (loginForm) {
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value;
                const rememberMe = document.getElementById('rememberMe').checked;
                
                if (!email || !password) {
                    alert('Email dan password harus diisi!');
                    return;
                }

                const users = JSON.parse(localStorage.getItem('users'));
                const user = users.find(u => u.email === email && u.password === password);
                
                if (!user) {
                    alert('Email atau password salah!');
                    return;
                }
                
                currentUser = user;
                if (rememberMe) {
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    sessionStorage.removeItem('currentUser');
                } else {
                    sessionStorage.setItem('currentUser', JSON.stringify(user));
                    localStorage.removeItem('currentUser');
                }
                
                const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                loginModal.hide();
                
                checkLoginStatus();
                alert('Login berhasil!');
            });
        }

        // Penanganan form registrasi
        const registerForm = document.getElementById('registerForm');
        if (registerForm) {
            registerForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('registerName').value.trim();
                const email = document.getElementById('registerEmail').value.trim();
                const password = document.getElementById('registerPassword').value;
                const confirmPassword = document.getElementById('registerConfirmPassword').value;
                
                if (!name || !email || !password || !confirmPassword) {
                    alert('Semua kolom harus diisi!');
                    return;
                }

                if (password !== confirmPassword) {
                    alert('Password dan konfirmasi password tidak cocok!');
                    return;
                }

                if (password.length < 6) {
                    alert('Password harus minimal 6 karakter!');
                    return;
                }

                const users = JSON.parse(localStorage.getItem('users'));
                if (users.find(u => u.email === email)) {
                    alert('Email sudah terdaftar!');
                    return;
                }
                
                users.push({
                    name,
                    email,
                    password,
                    createdAt: new Date().toISOString()
                });
                localStorage.setItem('users', JSON.stringify(users));
                
                alert('Pendaftaran berhasil! Silakan login.');
                
                const registerModal = bootstrap.Modal.getInstance(document.getElementById('registerModal'));
                registerModal.hide();
                const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                loginModal.show();
            });
        }

        // Penanganan logout
        const logoutBtn = document.querySelector('.logout-btn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                
                localStorage.removeItem('currentUser');
                sessionStorage.removeItem('currentUser');
                currentUser = null;
                
                checkLoginStatus();
                alert('Anda telah logout!');
            });
        }

        // Penanganan lupa password
        const forgotPasswordLink = document.getElementById('forgotPasswordLink');
        if (forgotPasswordLink) {
            forgotPasswordLink.addEventListener('click', function(e) {
                e.preventDefault();
                alert('Fitur reset password akan segera tersedia! Silakan hubungi info@wisatayuk.go.id.');
            });
        }

        // Penanganan link registrasi
        const registerLink = document.getElementById('registerLink');
        if (registerLink) {
            registerLink.addEventListener('click', function(e) {
                e.preventDefault();
                const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                loginModal.hide();
                const registerModal = new bootstrap.Modal(document.getElementById('registerModal'));
                registerModal.show();
            });
        }

        // Penanganan link terbatas (Publikasi)
        const restrictedLinks = document.querySelectorAll('.restricted-link');
        restrictedLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                if (!currentUser) {
                    const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                    loginModal.show();
                    alert('Silakan login terlebih dahulu untuk mengakses halaman Publikasi.');
                } else if (link.getAttribute('href') === 'peta-pertanahan.html') {
                    // Show map modal for "Peta Pertanahan" link
                    const mapModal = new bootstrap.Modal(document.getElementById('mapModal'));
                    mapModal.show();
                } else {
                    // Navigate to other restricted pages
                    window.location.href = link.getAttribute('href');
                }
            });
        });

        // Cek status login saat halaman dimuat
        window.addEventListener('load', function() {
            currentUser = JSON.parse(localStorage.getItem('currentUser') || sessionStorage.getItem('currentUser')) || null;
            checkLoginStatus();
        });
    </script>
</body>
</html>
